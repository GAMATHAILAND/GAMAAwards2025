<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GAMA Awards Frame Creator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background-color: #f0f2f5;
        }

        .container {
            background-color: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 800px;
            margin-bottom: 20px;
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 1.2em;
            margin-top: 25px;
            margin-bottom: 15px;
            color: #555;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }

        .upload-section, .frame-selection, .adjustment-section, .preview-section, .download-section {
            margin-bottom: 20px;
        }

        .file-input-wrapper {
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(90deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s ease;
            text-align: center;
            border: none;
            width: fit-content;
            margin: 0 auto;
        }

        .file-input-wrapper:hover {
            background: linear-gradient(90deg, #5c0cad 0%, #1a64e0 100%);
        }

        #imageUpload {
            display: none;
        }

        .frame-thumbnails {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
        }

        .frame-thumbnail-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .frame-thumbnail {
            width: 80px;
            height: 80px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: border-color 0.3s ease, transform 0.2s ease;
        }

        .frame-thumbnail img {
            max-width: 100%;
            max-height: 100%;
            display: block;
            object-fit: contain; /* Ensure the thumbnail image fits */
        }

        .frame-thumbnail.selected {
            border-color: #6a11cb;
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(106, 17, 203, 0.5);
        }

        .frame-label {
            text-align: center;
            font-size: 0.85em;
            color: #666;
            margin-top: 5px;
        }

        .slider-group {
            margin-bottom: 20px;
        }

        .slider-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #444;
        }

        .slider-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9em;
            color: #777;
        }

        input[type="range"] {
            width: calc(100% - 100px); /* Adjust width to make space for labels */
            -webkit-appearance: none;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
            opacity: 0.7;
            transition: opacity .2s;
            flex-grow: 1;
        }

        input[type="range"]:hover {
            opacity: 1;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #6a11cb;
            cursor: grab;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #6a11cb;
            cursor: grab;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
        }

        .preview-canvas-container {
            display: flex;
            justify-content: center;
            align-items: center;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            width: 300px; /* Fixed size for preview */
            height: 300px; /* Fixed size for preview */
            margin: 20px auto;
            position: relative;
        }

        #previewCanvas {
            max-width: 100%;
            max-height: 100%;
            display: block;
        }

        .download-button {
            display: block;
            width: fit-content;
            margin: 20px auto;
            background: linear-gradient(90deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 15px 30px;
            border-radius: 5px;
            text-decoration: none;
            font-size: 1.1em;
            text-align: center;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        .download-button:hover {
            background: linear-gradient(90deg, #5c0cad 0%, #1a64e0 100%);
            transform: translateY(-2px);
        }

        .disabled-button {
            background: #cccccc !important;
            cursor: not-allowed !important;
        }

        .logo-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .logo-header img {
            width: 100px; /* Adjust as needed */
            height: auto;
        }

    </style>
</head>
<body>

    <div class="container">
        <div class="logo-header">
            <img src="./GAMA%20Awards.png" alt="GAMA Awards Logo">
        </div>
        <h1>GAMA Awards Frame</h1>
        <p style="text-align: center; color: #666; margin-bottom: 30px;">
            เปลี่ยนรูปโปรไฟล์ของคุณให้โดดเด่นด้วยกรอบรูปภาพพิเศษจาก GAMA Awards อัพโหลดรูปภาพของคุณ เลือกกรอบที่ชอบ และดาวน์โหลดเพื่อใช้เป็นรูปโปรไฟล์ใหม่ของคุณ
        </p>

        <div class="upload-section">
            <div class="section-title">อัพโหลดรูปโปรไฟล์ของคุณ:</div>
            <label for="imageUpload" class="file-input-wrapper">
                เลือกรูปภาพจากเครื่อง
            </label>
            <input type="file" id="imageUpload" accept="image/*">
        </div>

        <div class="frame-selection">
            <div class="section-title">เลือกกรอบรูปภาพ</div>
            <div class="frame-thumbnails" id="frameThumbnails">
            </div>
        </div>

        <div class="adjustment-section">
            <div class="section-title">ปรับแต่งรูปภาพ</div>

            <div class="slider-group">
                <label>ขนาด:</label>
                <div class="slider-container">
                    <span>เล็ก</span>
                    <input type="range" id="sizeSlider" min="0.1" max="2.0" step="0.01" value="1.0">
                    <span>ใหญ่</span>
                </div>
            </div>

            <div class="slider-group">
                <label>ตำแหน่งแนวนอน:</label>
                <div class="slider-container">
                    <span>ซ้าย</span>
                    <input type="range" id="horizontalSlider" min="-0.5" max="0.5" step="0.01" value="0">
                    <span>ขวา</span>
                </div>
            </div>

            <div class="slider-group">
                <label>ตำแหน่งแนวตั้ง:</label>
                <div class="slider-container">
                    <span>บน</span>
                    <input type="range" id="verticalSlider" min="-0.5" max="0.5" step="0.01" value="0">
                    <span>ล่าง</span>
                </div>
            </div>
        </div>

        <div class="preview-section">
            <div class="section-title">ตัวอย่าง</div>
            <div class="preview-canvas-container">
                <canvas id="previewCanvas"></canvas>
            </div>
        </div>

        <div class="download-section">
            <button id="downloadBtn" class="download-button disabled-button" disabled>ดาวน์โหลดรูปโปรไฟล์</button>
            <p style="text-align: center; color: #777; margin-top: 10px;">ดาวน์โหลดและใช้เป็นรูปโปรไฟล์ของคุณบนโซเชียลมีเดีย</p>
        </div>
    </div>

    <script>
        const imageUpload = document.getElementById('imageUpload');
        const frameThumbnailsContainer = document.getElementById('frameThumbnails');
        const sizeSlider = document.getElementById('sizeSlider');
        const horizontalSlider = document.getElementById('horizontalSlider');
        const verticalSlider = document.getElementById('verticalSlider');
        const previewCanvas = document.getElementById('previewCanvas');
        const downloadBtn = document.getElementById('downloadBtn');
        const ctx = previewCanvas.getContext('2d');

        let userImage = null;
        let selectedFrame = null;
        let frameImages = {}; // To store loaded frame images

        const frames = [
            { id: 'MAA', name: 'Master Multiline Award', url: './MASTER%20MULTILINE%20Award.png' },
            { id: 'MFA', name: 'Master Firm Award', url: './MASTER%20FIRM%20Award.png' },
            { id: 'MMA', name: 'Master Agency Award', url: './MASTER%20AGENCY%20Award.png' },
            { id: 'IMA', name: 'International Management Award', url: './International%20Management%20Award.png' },
            { id: 'FLA', name: 'Frontline Leader Award', url: './Frontline%20Leader%20Awards.png' },
            { id: 'ERA', name: 'Excellence Recruitment Awards', url: './Excellence%20Recruitment%20Award.png' },
            { id: 'COE', name: 'Circle of Excellence Award', url: './Circle%20of%20Excellence%20Award.png' }
        ];

        // Define a consistent size for the PREVIEW canvas
        const previewCanvasSize = 500; 
        previewCanvas.width = previewCanvasSize;
        previewCanvas.height = previewCanvasSize;

        // Define the target download size
        const downloadCanvasSize = 1920; 

        // Function to load all frame images
        async function loadFrameImages() {
            for (const frame of frames) {
                const img = new Image();
                img.src = frame.url;
                img.crossOrigin = "anonymous"; // Essential if images are on a different domain or CDN

                await new Promise(resolve => {
                    img.onload = () => {
                        frameImages[frame.id] = img; // Store with frame.id as key
                        resolve();
                    };
                    img.onerror = () => {
                        console.error(`Failed to load frame image: ${frame.url}. Please ensure the image is accessible and hosted on the same domain or a CORS-enabled server.`);
                        resolve(); 
                    };
                });
            }
            renderThumbnails();
        }

        // Function to render frame thumbnails
        function renderThumbnails() {
            frameThumbnailsContainer.innerHTML = '';
            frames.forEach(frame => {
                const thumbnailWrapper = document.createElement('div');
                thumbnailWrapper.classList.add('frame-thumbnail-wrapper');

                const thumbnail = document.createElement('div');
                thumbnail.classList.add('frame-thumbnail');
                thumbnail.dataset.frameId = frame.id;

                const img = new Image();
                img.src = frame.url; // Thumbnail image src
                img.alt = frame.name;
                thumbnail.appendChild(img);

                const label = document.createElement('div');
                label.classList.add('frame-label');
                label.textContent = frame.id; // Using ID for brevity below thumbnail

                thumbnail.addEventListener('click', () => {
                    document.querySelectorAll('.frame-thumbnail').forEach(t => t.classList.remove('selected'));
                    thumbnail.classList.add('selected');
                    selectedFrame = frame.id;
                    drawCanvas(previewCanvas, ctx, previewCanvasSize); // Draw on preview canvas
                });

                thumbnailWrapper.appendChild(thumbnail);
                thumbnailWrapper.appendChild(label);
                frameThumbnailsContainer.appendChild(thumbnailWrapper);
            });
        }

        // Function to draw image and frame on a given canvas
        function drawCanvas(canvas, context, targetSize) {
            context.clearRect(0, 0, targetSize, targetSize);
            canvas.width = targetSize; // Temporarily set canvas size for drawing
            canvas.height = targetSize;

            if (!userImage || !selectedFrame) {
                // If either is missing, disable download and return
                downloadBtn.classList.add('disabled-button');
                downloadBtn.disabled = true;
                return;
            }

            const imgWidth = userImage.width;
            const imgHeight = userImage.height;

            let sourceX = 0;
            let sourceY = 0;
            let sourceWidth = imgWidth;
            let sourceHeight = imgHeight;

            const imgAspectRatio = imgWidth / imgHeight;
            const canvasAspectRatio = targetSize / targetSize; // Always 1 for square

            // Calculate "cover" fit for the user image
            if (imgAspectRatio > canvasAspectRatio) {
                // Image is wider, crop horizontal
                sourceHeight = imgHeight;
                sourceWidth = imgHeight * canvasAspectRatio;
                sourceX = (imgWidth - sourceWidth) / 2;
            } else {
                // Image is taller or same aspect ratio, crop vertical
                sourceWidth = imgWidth;
                sourceHeight = imgWidth / canvasAspectRatio;
                sourceY = (imgHeight - sourceHeight) / 2;
            }

            // Apply zoom (scale) from slider to the source dimensions
            const scale = parseFloat(sizeSlider.value);
            const scaledSourceWidth = sourceWidth / scale;
            const scaledSourceHeight = sourceHeight / scale;

            sourceX += (sourceWidth - scaledSourceWidth) / 2;
            sourceY += (sourceHeight - scaledSourceHeight) / 2;

            sourceX = Math.max(0, sourceX);
            sourceY = Math.max(0, sourceY);
            sourceWidth = Math.min(imgWidth - sourceX, scaledSourceWidth);
            sourceHeight = Math.min(imgHeight - sourceY, scaledSourceHeight);

            // Apply position adjustments from sliders to the destination on canvas
            const destX = parseFloat(horizontalSlider.value) * (targetSize / 2);
            const destY = parseFloat(verticalSlider.value) * (targetSize / 2);
            
            // Draw user image
            context.drawImage(userImage, sourceX, sourceY, sourceWidth, sourceHeight, destX, destY, targetSize, targetSize);

            // Draw selected frame on top
            if (selectedFrame && frameImages[selectedFrame]) {
                context.drawImage(frameImages[selectedFrame], 0, 0, targetSize, targetSize);
            }

            // Re-enable download button (only for the preview context, as this function is called from input changes)
            downloadBtn.classList.remove('disabled-button');
            downloadBtn.disabled = false;
        }

        // Event Listeners
        imageUpload.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        userImage = img;
                        // Reset sliders to default when a new image is uploaded
                        sizeSlider.value = 1.0;
                        horizontalSlider.value = 0;
                        verticalSlider.value = 0;
                        drawCanvas(previewCanvas, ctx, previewCanvasSize); // Draw on preview canvas
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        sizeSlider.addEventListener('input', () => drawCanvas(previewCanvas, ctx, previewCanvasSize));
        horizontalSlider.addEventListener('input', () => drawCanvas(previewCanvas, ctx, previewCanvasSize));
        verticalSlider.addEventListener('input', () => drawCanvas(previewCanvas, ctx, previewCanvasSize));

        downloadBtn.addEventListener('click', () => {
            if (userImage && selectedFrame) {
                const finalCanvas = document.createElement('canvas');
                const finalCtx = finalCanvas.getContext('2d');
                
                // Draw the image on the hidden, high-resolution canvas
                drawCanvas(finalCanvas, finalCtx, downloadCanvasSize);

                const dataURL = finalCanvas.toDataURL('image/png');

                // Check for iOS (iPad, iPhone, iPod)
                const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;

                if (isIOS) {
                    // For iOS, open in a new tab so user can long-press and save
                    const newWindow = window.open();
                    newWindow.document.write(`<img src="${dataURL}" style="width:100%;">`);
                    newWindow.document.title = `GAMA_Awards_Profile_${selectedFrame}.png`;
                    // You might want to add a message to the user here
                    alert('สำหรับผู้ใช้ iOS: รูปภาพจะเปิดในหน้าต่างใหม่ กรุณากดค้างที่รูปภาพเพื่อบันทึก');
                } else {
                    // For Android and other devices, direct download should work
                    const link = document.createElement('a');
                    link.download = `GAMA_Awards_Profile_${selectedFrame}.png`;
                    link.href = dataURL;
                    document.body.appendChild(link); // Append to body is good practice
                    link.click();
                    document.body.removeChild(link); // Clean up
                }
            }
        });

        // Initialize by loading frame images
        loadFrameImages();

        // Initial draw in case there's a default image or to set up the blank canvas
        drawCanvas(previewCanvas, ctx, previewCanvasSize); 
    </script>
</body>
</html>
