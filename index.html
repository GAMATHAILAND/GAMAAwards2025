<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GAMA Awards Frame Creator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background-color: #f0f2f5;
        }

        .container {
            background-color: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 800px;
            margin-bottom: 20px;
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 1.2em;
            margin-top: 25px;
            margin-bottom: 15px;
            color: #555;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }

        .upload-section, .frame-selection, .adjustment-section, .preview-section, .download-section {
            margin-bottom: 20px;
        }

        .file-input-wrapper {
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(90deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s ease;
            text-align: center;
            border: none;
            width: fit-content;
            margin: 0 auto;
        }

        .file-input-wrapper:hover {
            background: linear-gradient(90deg, #5c0cad 0%, #1a64e0 100%);
        }

        #imageUpload {
            display: none;
        }

        .frame-thumbnails {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
        }

        .frame-thumbnail-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .frame-thumbnail {
            width: 80px;
            height: 80px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: border-color 0.3s ease, transform 0.2s ease;
        }

        .frame-thumbnail img {
            max-width: 100%;
            max-height: 100%;
            display: block;
            object-fit: contain; /* Ensure the thumbnail image fits */
        }

        .frame-thumbnail.selected {
            border-color: #6a11cb;
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(106, 17, 203, 0.5);
        }

        .frame-label {
            text-align: center;
            font-size: 0.85em;
            color: #666;
            margin-top: 5px;
        }

        .slider-group {
            margin-bottom: 20px;
        }

        .slider-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #444;
        }

        .slider-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9em;
            color: #777;
        }

        input[type="range"] {
            width: calc(100% - 100px); /* Adjust width to make space for labels */
            -webkit-appearance: none;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
            opacity: 0.7;
            transition: opacity .2s;
            flex-grow: 1;
        }

        input[type="range"]:hover {
            opacity: 1;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #6a11cb;
            cursor: grab;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #6a11cb;
            cursor: grab;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
        }

        .preview-canvas-container {
            display: flex;
            justify-content: center;
            align-items: center;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            width: 300px; /* Fixed size for preview */
            height: 300px; /* Fixed size for preview */
            margin: 20px auto;
            position: relative;
        }

        #previewCanvas {
            max-width: 100%;
            max-height: 100%;
            display: block;
        }

        .download-button {
            display: block;
            width: fit-content;
            margin: 20px auto;
            background: linear-gradient(90deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 15px 30px;
            border-radius: 5px;
            text-decoration: none;
            font-size: 1.1em;
            text-align: center;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        .download-button:hover {
            background: linear-gradient(90deg, #5c0cad 0%, #1a64e0 100%);
            transform: translateY(-2px);
        }

        .disabled-button {
            background: #cccccc !important;
            cursor: not-allowed !important;
        }

        .logo-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .logo-header img {
            width: 100px; /* Adjust as needed */
            height: auto;
        }

    </style>
</head>
<body>

    <div class="container">
        <div class="logo-header">
            <img src="https://hugmediacreation.com/photo/GAMA%20Awards.png" alt="GAMA Awards Logo">
        </div>
        <h1>GAMA Awards Frame</h1>
        <p style="text-align: center; color: #666; margin-bottom: 30px;">
            เปลี่ยนรูปโปรไฟล์ของคุณให้โดดเด่นด้วยกรอบรูปภาพพิเศษจาก GAMA Awards อัพโหลดรูปภาพของคุณ เลือกกรอบที่ชอบ และดาวน์โหลดเพื่อใช้เป็นรูปโปรไฟล์ใหม่ของคุณ
        </p>

        <div class="upload-section">
            <div class="section-title">อัพโหลดรูปโปรไฟล์ของคุณ:</div>
            <label for="imageUpload" class="file-input-wrapper">
                เลือกรูปภาพจากเครื่อง
            </label>
            <input type="file" id="imageUpload" accept="image/*">
        </div>

        <div class="frame-selection">
            <div class="section-title">เลือกกรอบรูปภาพ</div>
            <div class="frame-thumbnails" id="frameThumbnails">
                </div>
        </div>

        <div class="adjustment-section">
            <div class="section-title">ปรับแต่งรูปภาพ</div>

            <div class="slider-group">
                <label>ขนาด:</label>
                <div class="slider-container">
                    <span>เล็ก</span>
                    <input type="range" id="sizeSlider" min="0.1" max="2.0" step="0.01" value="1.0">
                    <span>ใหญ่</span>
                </div>
            </div>

            <div class="slider-group">
                <label>ตำแหน่งแนวนอน:</label>
                <div class="slider-container">
                    <span>ซ้าย</span>
                    <input type="range" id="horizontalSlider" min="-0.5" max="0.5" step="0.01" value="0">
                    <span>ขวา</span>
                </div>
            </div>

            <div class="slider-group">
                <label>ตำแหน่งแนวตั้ง:</label>
                <div class="slider-container">
                    <span>บน</span>
                    <input type="range" id="verticalSlider" min="-0.5" max="0.5" step="0.01" value="0">
                    <span>ล่าง</span>
                </div>
            </div>
        </div>

        <div class="preview-section">
            <div class="section-title">ตัวอย่าง</div>
            <div class="preview-canvas-container">
                <canvas id="previewCanvas"></canvas>
            </div>
        </div>

        <div class="download-section">
            <button id="downloadBtn" class="download-button disabled-button" disabled>ดาวน์โหลดรูปโปรไฟล์</button>
            <p style="text-align: center; color: #777; margin-top: 10px;">ดาวน์โหลดและใช้เป็นรูปโปรไฟล์ของคุณบนโซเชียลมีเดีย</p>
        </div>
    </div>

    <script>
        const imageUpload = document.getElementById('imageUpload');
        const frameThumbnailsContainer = document.getElementById('frameThumbnails');
        const sizeSlider = document.getElementById('sizeSlider');
        const horizontalSlider = document.getElementById('horizontalSlider');
        const verticalSlider = document.getElementById('verticalSlider');
        const previewCanvas = document.getElementById('previewCanvas');
        const downloadBtn = document.getElementById('downloadBtn');
        const ctx = previewCanvas.getContext('2d');

        let userImage = null;
        let selectedFrame = null;
        let frameImages = {}; // To store loaded frame images

        const frames = [
            { id: 'MAA', name: 'Master Multiline Award', url: 'https://hugmediacreation.com/photo/MASTER%20MULTILINE%20Award.png' },
            { id: 'MFA', name: 'Master Firm Award', url: 'https://hugmediacreation.com/photo/MASTER%20FIRM%20Award.png' },
            { id: 'MMA', name: 'Master Agency Award', url: 'https://hugmediacreation.com/photo/MASTER%20AGENCY%20Award.png' },
            { id: 'IMA', name: 'International Management Award', url: 'https://hugmediacreation.com/photo/International%20Management%20Award.png' },
            { id: 'FLA', name: 'Frontline Leader Award', url: 'https://hugmediacreation.com/photo/Frontline%20Leader%20Awards.png' },
            { id: 'ERA', name: 'Excellence Recruitment Awards', url: 'https://hugmediacreation.com/photo/Excellence%20Recruitment%20Award.png' },
            { id: 'COE', name: 'Circle of Excellence Award', url: 'https://hugmediacreation.com/photo/Circle%20of%20Excellence%20Award.png' }
        ];

        // Set canvas dimensions
        const canvasSize = 500; // Define a consistent size for the canvas
        previewCanvas.width = canvasSize;
        previewCanvas.height = canvasSize;

        // Function to load all frame images
        async function loadFrameImages() {
            for (const frame of frames) {
                const img = new Image();
                img.src = frame.url;
                img.crossOrigin = "anonymous"; // Essential for loading cross-origin images to canvas
                await new Promise(resolve => {
                    img.onload = () => {
                        frameImages[frame.id] = img; // Store with frame.id as key
                        resolve();
                    };
                    img.onerror = () => {
                        console.error(`Failed to load frame image: ${frame.url}`);
                        resolve(); // Still resolve to continue with other images
                    };
                });
            }
            renderThumbnails();
        }

        // Function to render frame thumbnails
        function renderThumbnails() {
            frameThumbnailsContainer.innerHTML = '';
            frames.forEach(frame => {
                const thumbnailWrapper = document.createElement('div');
                thumbnailWrapper.classList.add('frame-thumbnail-wrapper');

                const thumbnail = document.createElement('div');
                thumbnail.classList.add('frame-thumbnail');
                thumbnail.dataset.frameId = frame.id;

                const img = new Image();
                img.src = frame.url;
                img.alt = frame.name;
                thumbnail.appendChild(img);

                const label = document.createElement('div');
                label.classList.add('frame-label');
                label.textContent = frame.id; // Using ID for brevity below thumbnail

                thumbnail.addEventListener('click', () => {
                    document.querySelectorAll('.frame-thumbnail').forEach(t => t.classList.remove('selected'));
                    thumbnail.classList.add('selected');
                    selectedFrame = frame.id;
                    drawCanvas();
                });

                thumbnailWrapper.appendChild(thumbnail);
                thumbnailWrapper.appendChild(label);
                frameThumbnailsContainer.appendChild(thumbnailWrapper);
            });
        }

        // Function to draw image and frame on canvas
        function drawCanvas() {
            ctx.clearRect(0, 0, previewCanvas.width, previewCanvas.height);

            if (!userImage && !selectedFrame) {
                downloadBtn.classList.add('disabled-button');
                downloadBtn.disabled = true;
                return;
            }

            // Draw user image if available
            if (userImage) {
                const imgWidth = userImage.width;
                const imgHeight = userImage.height;
                const canvasWidth = previewCanvas.width;
                const canvasHeight = previewCanvas.height;

                let sourceX = 0;
                let sourceY = 0;
                let sourceWidth = imgWidth;
                let sourceHeight = imgHeight;

                let destX = 0;
                let destY = 0;
                let destWidth = canvasWidth;
                let destHeight = canvasHeight;

                // Calculate aspect ratio of image and canvas
                const imgAspectRatio = imgWidth / imgHeight;
                const canvasAspectRatio = canvasWidth / canvasHeight;

                // Determine how to fit the image: "cover" the canvas area
                if (imgAspectRatio > canvasAspectRatio) {
                    // Image is wider than canvas, so scale height to match canvas height
                    // and crop horizontally
                    sourceHeight = imgHeight;
                    sourceWidth = imgHeight * canvasAspectRatio;
                    sourceX = (imgWidth - sourceWidth) / 2;
                } else {
                    // Image is taller or same aspect ratio as canvas, scale width
                    // and crop vertically
                    sourceWidth = imgWidth;
                    sourceHeight = imgWidth / canvasAspectRatio;
                    sourceY = (imgHeight - sourceHeight) / 2;
                }

                // Apply zoom (scale) from slider
                const scale = parseFloat(sizeSlider.value);
                const scaledSourceWidth = sourceWidth / scale;
                const scaledSourceHeight = sourceHeight / scale;

                // Adjust sourceX/Y to keep the "center" of the scaled image
                // around the center of the original image (before scaling)
                sourceX += (sourceWidth - scaledSourceWidth) / 2;
                sourceY += (sourceHeight - scaledSourceHeight) / 2;
                sourceWidth = scaledSourceWidth;
                sourceHeight = scaledSourceHeight;
                
                // Ensure source dimensions don't go out of bounds
                sourceX = Math.max(0, sourceX);
                sourceY = Math.max(0, sourceY);
                sourceWidth = Math.min(imgWidth - sourceX, sourceWidth);
                sourceHeight = Math.min(imgHeight - sourceY, sourceHeight);

                // Apply position adjustments from sliders
                // These shifts are relative to the canvas size, scaled by 0.5 (max shift is half canvas)
                const horizontalShift = parseFloat(horizontalSlider.value) * (canvasWidth / 2);
                const verticalShift = parseFloat(verticalSlider.value) * (canvasHeight / 2);

                // Adjust destination coordinates based on sliders
                // This essentially moves the drawn image within the canvas
                destX = horizontalShift;
                destY = verticalShift;
                
                // Draw the user image
                ctx.drawImage(userImage, sourceX, sourceY, sourceWidth, sourceHeight, destX, destY, destWidth, destHeight);
            }

            // Draw selected frame on top of the user image
            if (selectedFrame && frameImages[selectedFrame]) {
                ctx.drawImage(frameImages[selectedFrame], 0, 0, previewCanvas.width, previewCanvas.height);
            }

            // Enable download button if both image and frame are present
            if (userImage && selectedFrame) {
                downloadBtn.classList.remove('disabled-button');
                downloadBtn.disabled = false;
            } else {
                downloadBtn.classList.add('disabled-button');
                downloadBtn.disabled = true;
            }
        }

        // Event Listeners
        imageUpload.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        userImage = img;
                        // Reset sliders to default when a new image is uploaded
                        sizeSlider.value = 1.0;
                        horizontalSlider.value = 0;
                        verticalSlider.value = 0;
                        drawCanvas();
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        sizeSlider.addEventListener('input', drawCanvas);
        horizontalSlider.addEventListener('input', drawCanvas);
        verticalSlider.addEventListener('input', drawCanvas);

        downloadBtn.addEventListener('click', () => {
            if (userImage && selectedFrame) {
                const link = document.createElement('a');
                link.download = `GAMA_Awards_Profile_${selectedFrame}.png`;
                link.href = previewCanvas.toDataURL('image/png');
                link.click();
            }
        });

        // Initialize by loading frame images
        loadFrameImages();
    </script>
</body>
</html>
