<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>GAMA Awards Checker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    body { font-family: 'Prompt', sans-serif; background: linear-gradient(to bottom, #6610f2, #6f42c1); color: #111; }
    .modal-bg { background-color: rgba(0, 0, 0, 0.6); }
  </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center px-4">
  <img src="https://hugmediacreation.com/wp-content/uploads/2025/04/cropped-logo-hug-B.png" alt="GAMA Logo" class="w-24 mb-6">
  <h1 class="text-white text-3xl font-bold mb-2">ตรวจสอบรายชื่อผู้เข้ารับรางวัล</h1>
  <p class="text-white mb-6">กรุณากรอกชื่อ–นามสกุล หรือรหัสผู้ได้รับรางวัล</p>

  <div class="bg-white shadow-md rounded-xl p-6 w-full max-w-md">
    <input id="search" type="text" class="w-full border border-gray-300 rounded-md px-4 py-2 mb-4" placeholder="เช่น ศรินยา นิยมสำรวจ หรือ EYKYH87K15">
    <button onclick="searchData()" class="w-full bg-purple-800 hover:bg-purple-700 text-white font-semibold py-2 rounded-md">ค้นหา</button>
    <div id="error" class="text-red-600 text-center mt-3 hidden">เกิดข้อผิดพลาดในการเชื่อมต่อ กรุณาลองใหม่อีกครั้ง</div>
  </div>

  <!-- Modal -->
  <div id="modal" class="fixed inset-0 hidden items-center justify-center modal-bg z-50">
    <div class="bg-white rounded-2xl shadow-lg w-full max-w-xl p-8 relative text-center">
      <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-lg">&times;</button>
      <img src="https://hugmediacreation.com/wp-content/uploads/2025/04/cropped-logo-hug-B.png" alt="GAMA Logo" class="w-16 mx-auto mb-4">
      <div id="result" class="text-gray-800 text-left space-y-1 mb-4"></div>
      <div id="qr-code" class="flex justify-center mt-6"></div>
    </div>
  </div>

  <script>
    async function searchData() {
      const query = document.getElementById("search").value.trim();
      const modal = document.getElementById("modal");
      const resultBox = document.getElementById("result");
      const qrBox = document.getElementById("qr-code");
      const errorBox = document.getElementById("error");

      if (!query) return;

      modal.classList.remove("hidden");
      resultBox.innerHTML = "กำลังค้นหา...";
      qrBox.innerHTML = "";
      errorBox.classList.add("hidden");

      try {
        const res = await fetch(`https://script.google.com/macros/s/AKfycbwcAq-tg2JwP7tsnRY5AMWc1NjDJVwhodgS9KMffS50OI9o1GNo84JR_qcUqyjaHUCa/exec?q=${encodeURIComponent(query)}`);
        const data = await res.json();

        if (data.error) {
          resultBox.innerHTML = `
            <h2 class="text-xl font-bold text-purple-700">ไม่พบข้อมูล</h2>
            <p class="text-gray-700">ขออภัย, ไม่พบข้อมูลของผู้เข้ารับรางวัลที่ท่านค้นหา<br/>กรุณาตรวจสอบชื่อหรือรหัสอีกครั้ง</p>`;
          return;
        }

        resultBox.innerHTML = `
          <h2 class="text-2xl font-bold text-purple-700 mb-4">ข้อมูลผู้รับรางวัล</h2>
          <p><strong>ID:</strong> ${data.id}</p>
          <p><strong>ชื่อ-นามสกุล:</strong> ${data.name}</p>
          <p><strong>สังกัด:</strong> ${data.organization}</p>
          <p><strong>ประเภทรางวัล:</strong> ${data.awardType}</p>
          <p><strong>ระดับ:</strong> ${data.level}</p>
          <p><strong>รหัสใบอนุญาต:</strong> ${data.licenseCode || "-"}</p>`;

        new QRCode(qrBox, {
          text: data.id,
          width: 128,
          height: 128
        });
      } catch (e) {
        console.error(e);
        errorBox.classList.remove("hidden");
        resultBox.innerHTML = "";
      }
    }

    function closeModal() {
      document.getElementById("modal").classList.add("hidden");
      document.getElementById("qr-code").innerHTML = "";
    }
  </script>
</body>
</html>
