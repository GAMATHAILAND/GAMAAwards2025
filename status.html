<script>
  const API_URL = "https://script.google.com/macros/s/AKfycbwcAq-tg2JwP7tsnRY5AMWc1NjDJVwhodgS9KMffS50OI9o1GNo84JR_qcUqyjaHUCa/exec";

  async function search() {
    const q = document.getElementById("searchInput").value.trim();
    const errBox = document.getElementById("errorMsg");
    const resultBox = document.getElementById("resultContent");
    errBox.textContent = "";
    resultBox.innerHTML = "";

    if (q.length < 2) {
      errBox.textContent = "กรุณากรอกข้อมูลให้ครบถ้วน";
      return;
    }

    try {
      const res = await fetch(`${API_URL}?q=${encodeURIComponent(q)}`);
      const data = await res.json();

      if (!data.name) {
        errBox.textContent = "ไม่พบข้อมูล กรุณาลองใหม่";
        return;
      }

      // แสดงผล
      resultBox.innerHTML = `
        <h3>รหัส: ${data.id}</h3>
        <p>ชื่อ: ${data.name}</p>
        <p>สังกัด: ${data.organization}</p>
        <p>ประเภท: ${data.awardType}</p>
        <p>ระดับ: ${data.level}</p>
      `;
      document.getElementById("resultModal").style.display = "block";

    } catch (error) {
      errBox.textContent = "เกิดข้อผิดพลาดในการเชื่อมต่อ กรุณาลองใหม่";
    }
  }

  function closeModal(event) {
    if (event.target.id === "resultModal") {
      document.getElementById("resultModal").style.display = "none";
    }
  }
</script>
